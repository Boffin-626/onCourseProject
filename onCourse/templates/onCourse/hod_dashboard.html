{% extends 'onCourse/base.html' %}
{% load static %}

{% block page_content %}
<h4>{{ school.name }} | HOD Dashboard</h4>

<h4 style="text-align: center;">Overall Learner Performance</h4>

<canvas id="performanceChart" width="400" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  var ctx = document.getElementById('performanceChart').getContext('2d');
  var performanceChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Grasped', 'Not Grasped'],
      datasets: [{
        label: 'Percentage of Concepts grasped vs not_grasped',
        data: [{{ grasped_percentage }}, {{ not_grasped_percentage }}],
        backgroundColor: [
          'rgba(75, 192, 192, 0.2)',
          'rgba(255, 99, 132, 0.2)'
        ],
        borderColor: [
          'rgba(75, 192, 192, 1)',
          'rgba(255, 99, 132, 1)'
        ],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

<h3>Teacher Engagement</h3>
<canvas id="engagementChart" width="400" height="200"></canvas>

<script>
  var ctx = document.getElementById('engagementChart').getContext('2d');
  var engagementChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [{% for comment in comments_per_learner %}'{{ comment.progress_report__learner.name }}',{% endfor %}],
      datasets: [{
        label: 'Teacher Comments',
        data: [{% for comment in comments_per_learner %}{{ comment.total_comments }},{% endfor %}],
        backgroundColor: 'rgba(153, 102, 255, 0.2)',
        borderColor: 'rgba(153, 102, 255, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

<h3>Filter Data</h3>
<form method="get" action="{% url 'onCourse:hod_dashboard' %}">
  <label for="start_date">Start Date:</label>
  <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date }}">
  
  <label for="end_date">End Date:</label>
  <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date }}">

  <label for="subject">Subject:</label>
  <select id="subject" name="subject">
    <option value="">All Subjects</option>
    {% for subject in subjects %}
      <option value="{{ subject }}" {% if request.GET.subject == subject %}selected{% endif %}>{{ subject }}</option>
    {% endfor %}
  </select>

  <button type="submit">Filter</button>
</form>

<h4>Learner Progress</h4>
<table id="report">
    <tr>
        <th>Learner Name</th>
        <th>Concepts Grasped</th>
        <th style="background-color: orange;">Concepts Not Grasped</th>
        <th>Period</th>
        <th>Teacher Comments</th>
    </tr>
    {% for progress in learner_progress %}
    <tr>
        <td>{{ progress.learner.name }}</td>
        <td>{{ progress.concepts_grasped }}</td>
        <td>{{ progress.concepts_not_grasped }}</td>
        <td>{{ progress.period_start }} - {{ progress.period_end }}</td>
        <td>
            {% for comment in teacher_comments %}
                {% if comment.progress_report_id == progress.id %}
                    {{ comment.comment }} ({{ comment.teacher.name }})
                {% endif %}
            {% endfor %}
        </td>
    </tr>
    {% endfor %}
</table>
<h4>Export Data</h4>
<a href="#" class="btn btn-warning">Export to CSV</a>

{% endblock page_content %}
